\renewcommand{\arraystretch}{1.5}
\chapter[Boxen \LILLYxBOXxVersion{\small 1.0.0}]{Boxen}
\TitleSUB{Boxes in Boxes in Boxes in Boxes\ldots \hfill \LILLYxBOXxVersion{\small 1.0.0}}
\section{Grundlegendes}
\subsection{Eine kleine Einführung}
%
% \TransformBoxDefinition{definition}{Waffelmaker~\noexpand\thetcbcounter~}
%
% \TransformBoxDefinitionS{definition*}{WaffelmakerX~\noexpand\thetcbcounter~}
%
% \elable{mrk:xxx}
% \begin{definition}[Hallo Welt]
%     Na du? \jmark[chap:Listings]{mrk:xxx}
% \end{definition}
%
% \listofDEFINITIONS
%
Die 3 Standard-Designs, welche mit LILLY ausgeliefert werden lauten wie folgt:
\begin{tabularx}{\linewidth}{!{\VRule[1pt]}@{\hspace{1em}}c@{\hspace{1em}}|@{\hspace{1em}}c@{\hspace{1em}}|@{\hspace{1em}}c@{\hspace{1em}}!{\VRule[1pt]}}
    \specialrule{1pt}{0pt}{0pt}
    \bfseries DEFAULT & \bfseries ALTERNATE & \bfseries LIMERENCE \\\hline %% Leider ist es nicht möglich zu mischen ^^
{\input{\LILLYxPATHxDATA/POIs/_LILLY_BOXES_DEFAULT}\hspace{-3.25em}\begin{minipage}{0.32\linewidth}
    \begin{satz}[Nice]
        Superwichtig
    \end{satz}
\end{minipage}} & {\input{\LILLYxPATHxDATA/POIs/_LILLY_BOXES_ALTERNATE}\hspace{-3.25em}\begin{minipage}{0.32\linewidth}
    \begin{satz}[Nice]
        Superwichtig
    \end{satz}
\end{minipage}} & {\input{\LILLYxPATHxDATA/POIs/_LILLY_BOXES_LIMERENCE}\hspace{-3.25em}\begin{minipage}{0.32\linewidth}
    \begin{satz}[Nice]
        Superwichtig
    \end{satz}
\end{minipage}}
\\
    \specialrule{1pt}{0pt}{0pt}
    \end{tabularx}
Auch wenn sie hier explizit forciert wurden ist es grundlegend möglich (und auch so gedacht) sie mithilfe des Makefiles konfiguerieren. Die allgemeine Syntax bis \LILLYxBOXxVersion{1.7.0} hierfür lautet:
\begin{bash}
make "BOXMODE=<Name>"
\end{bash}
Mit \LILLYxBOXxVersion{2.0.0} regelt \Jake die jeweilige Variante und erlaubt es sogar, mehrere Boxmodi gleichzeitig generieren zu lassen: 
\begin{bash}
jake :lan:Datei:ran: -lilly-boxes: ":lan:Namen:ran:"
\end{bash}
Um eine Fassng für jede Box zu generieren entspräche das:
\begin{bash}
jake :lan:Datei:ran: -lilly-boxes: "DEFAULT ALTERNATE LIMERENCE"
\end{bash}
wobei \T{<Name>} mit einem der oben stehenden Bezeichner ersetzt wird. Die Bezeichner werden vom weiter unten näher beschriebenem Box-Controller wie folgt aufgelöst:
\begin{latex}
\input{\LILLYxPATHxDATA/POIs/_LILLY_BOXES_!**!\LILLYxBOXxMODE}
\end{latex}
%\marginpar{\tiny Natürlich wäre es schöner auch andere Verzeichnisse zuzulasen und hierbei dann den gesamten Pfad anzugeben - dies ist aber bisher auch noch zu machen}
Über genau dieses Verfahren lassen sich auch beliebig die Box-Designs erweitern.
\subsection{Der Box-Controller}
Diese Definitionen befinden sich in der Datei: {\ltt Controllers/LILLYxCONTROLLERxBOX}. Sie werden mit \LILLYxBOXxVersion{2.0.0} automatisch mit dem Einbinden von\newline \LILLYxNOTExLibrary{LILLYxCONTROLLERxBOX} geladen.\medskip\newline
%
%
%
\presentCommand[1.5.0]{LILLYxBOXxMODE}[]
Hierrüber wird ausgewählt welcher der jeweiligen Boxmodi verwendet werden soll. Standardmäßig wird dieser Befehl von \Jake gesetzt, aber natürlich kann dieser Befehl auch überschreiben werden.

\presentCommand[1.8.0]{LILLYxBOXx<Bezeichner>xLock}[]
Enthält für die jeweilige Box, woran sich der Zähler orientieren soll. Enthält der Befehl \T{\true}, so wird ein Ungebundener Zähler verwendet. Wenn nicht definiert initialisiert durch:

\presentCommand[1.8.0]{LILLYxBOXxHIGHLEVELxLOCK}[]
Enthält je nach Dokumenttyp entweder die höchste Hierarchie, an die ein Zähler gebunden werden kann oder \T{\true}. So erzeugt \T{\true} zum Beispiel den Zähler \T{4} und \T{section} in einem Dokument mit \blankcmd{chapter}: \T{1.13.4}.

\presentCommand[1.8.0]{LILLYxBOXx<Bezeichner>xEnable}[]
Definiert, ob eine Box überhaupt angezeigt werden soll. Durch das Setzen auf \T{\false}, kann so eine Box aus dem Dokument genommen werden.

\presentCommand[1.8.0]{LILLYxBOXx<Bezeichner>xBox}[]
Dieser Befehl besitzt (Stand \LILLYxBOXxVersion{2.0.0}) nicht für alle Boxbezeichner einen Effekt, steuert aber für bereits implementierte Boxen, ob diese durch das jeweilige Layout gesetzt werden sollen, oder ob die Box ohne die Box angezeigt werden soll. Die genaue Optik bestimmt wieder der jeweilige Modi.

\begin{bemerkung}[Box-Kontrolle]
    Alle von Lilly generierten Boxen befinden sich mit \LILLYxBOXxVersion{2.0.0} in der Liste: \T{RegisteredBoxes} mit der Signatur \T{Name/Bezeichner}. So gehen die Konfigurationen wie folgt von statten:
\begin{latex}
\def!**!\LILLYxBOXxBeweisxBox{FALSE} % Deaktiviert Beweisboxen
\end{latex}
\end{bemerkung}

Hier die definierten Umgebungen in ihrer freien Wildbahn und Gestalt:

%%PYSCRIPT:
%
% b = ("definition", "definition*", "bemerkung", "beispiel", "satz", "beweis", "lemma", "zusammenfassung", "aufgabe")
% for a in b:
%   print("\\begingroup\\begin{%s}[Titel]\nmoin" % (a))
%   print("\\begin{lstlisting}[language=lLatex]")
%   print("\\begin{%s}[Titel]\n\tmoin" % (a))
%   print("\\end{%s}\end{lstlisting}" % (a))
%   print("\\end{%s}\\endgroup" % (a))
%   print()

\begingroup\begin{definition}[Titel]
moin
\begin{lstlisting}[language=lLatex]
\begin{definition}[Titel]
        moin
\end{definition}\end{lstlisting}
\end{definition}\endgroup

\begingroup\begin{definition*}[Titel]
moin
\begin{lstlisting}[language=lLatex]
\begin{definition*}[Titel]
        moin
\end{definition*}\end{lstlisting}
\end{definition*}\endgroup

\begingroup\begin{bemerkung}[Titel]
moin
\begin{lstlisting}[language=lLatex]
\begin{bemerkung}[Titel]
        moin
\end{bemerkung}\end{lstlisting}
\end{bemerkung}\endgroup

\begingroup\begin{beispiel}[Titel]
moin
\begin{lstlisting}[language=lLatex]
\begin{beispiel}[Titel]
        moin
\end{beispiel}\end{lstlisting}
\end{beispiel}\endgroup

\begingroup\begin{satz}[Titel]
moin
\begin{lstlisting}[language=lLatex]
\begin{satz}[Titel]
        moin
\end{satz}\end{lstlisting}
\end{satz}\endgroup


\begingroup\begin{beweis}[Titel]
moin
\begin{lstlisting}[language=lLatex]
\begin{beweis}[Titel]
        moin
\end{beweis}\end{lstlisting}
\end{beweis}\endgroup

\begingroup\begin{lemma}[Titel]
moin
\begin{lstlisting}[language=lLatex]
\begin{lemma}[Titel]
        moin
\end{lemma}\end{lstlisting}
\end{lemma}\endgroup

\begingroup\begin{zusammenfassung}[Titel]
moin
\begin{lstlisting}[language=lLatex]
\begin{zusammenfassung}[Titel]
        moin
\end{zusammenfassung}\end{lstlisting}
\end{zusammenfassung}\endgroup

\begingroup\begin{aufgabe}{Titel}{3}
moin
\begin{lstlisting}[language=lLatex]
\begin{aufgabe}{Titel}{3}
        moin
\end{aufgabe}\end{lstlisting}
\end{aufgabe}\endgroup

Nicht richtig darstellbar aber weiter existiert:
\begin{lstlisting}[language=lLatex]
\begin{uebungsblatt}[Titel][2]
        moin
\end{uebungsblatt}\end{lstlisting}

\presentEnvironment[1.0.0]{task}[\optArg{opt-Addons}\manArg{Titel}\manArg{Punkte}\cmdold]
Ein aus dem \T{eagleStudiPackage} stammendes Relikt, welches nur aus Kompatibilitätsgründen gehalten wird. Ebenso:

\presentCommand[1.0.0]{DEF}[\manArg{Title}\manArg{Content}\cmdlist \blankcmd{BEM}\manArg{Titel}\manArg{Content}\cmdold]
Kompatibilitätsbefehle, der zur \T{eagleStudiPackage}-Zeit die Boxen gesetzt hat, nun allerdings die Daten an die jeweilige Umgebung weitergeben. 

\presentCommand[1.0.3]{inputUB}[\manArg{Name}\manArg{Nummer}\manArg{Pfad}\cmdlist \blankcmd{inputUBS}\manArg{Name}\manArg{Bezeichner}\manArg{Pfad}]
Binden eine Datei als Übungsblatt ein und erlaubt so, Übungsblätter in Mitschriften zu integrieren. Letzterer Befehl verwendet \clatex{uebungsblatt*}, verändert also nicht die Nummer, was bedeutet, dass auch Buchstaben oder anderes als Bezeichner möglich ist. \emph{Diese werden, entsprechend der Regel von \clatex{uebungsblatt} nur angezeigt, sofern \blankcmd{LILLYxMODExEXTRA} den Wert \T{\true} enthält.}


\begin{bemerkung}[Zugriff auf die Boxzähler]
    Der Zugriff auf die von Lilly unterhaltenen Boxzähler ist sehr Umständlich (Beispiel: \blankcmd{thetcb@cnt@LILLYxBOXxDefinition}). Deswegen existiert das Hilfspaket \LILLYxNOTExLibrary{LILLYxBOXxCOUNTER}, welches hierfür Kurzbefehle definiert: \typesetList[blankcmd]{CTRxDEF,CTRxBEI,CTRxBEM,CTRxSAT,CTRxBEW,CTRxLEM,CTRxZSM}. So liefert \blatex{:bs:arabic\{:bs:CTRxDEF\}}: \T{\arabic{\CTRxDEF}}.
\end{bemerkung}

\presentCommand[2.0.0]{RegisterBox}[\optArg{Box-Keys}\optArg{Tikz-Keys}\manArg{Box-Name}\manArg{Title}\manArg{GroupID}]
Registriert eine (neue) oder alte Box, die entsprechend Gesetzt werden kann. Die gezielte Verwendung dieses Befehls bedarf einiger Vorkenntnisse über das jeweilige Szenario. Es werden eine ganze Menge an \T{Box-Keys} gestattet, die auf einem anderen Verfahren persistiert werden (weswegen Box-gebundene Befehle mithilfe von \blankcmd{noexpand} abgesichert werden müssen!):
\begin{center}
    \begin{tabularx}{0.96\linewidth}{^t>{\em}^l^c^l+}
        \toprule
            \headerrow Bezeichner & \normalfont\bfseries Typ & Standard & Beschreibung\\
        \midrule
        name & String & noname & Name der Box \\
        title & String & <name> & Titel der Box \\
        boxcol & Farbe & black & Farbe für Links \\
        preCode & Code &  & Befehle, die vor der Box gesetzt werden \\
        inCode & Code &  & Befehle, die zu Beginn der Box gesetzt werden \\
        outCode & Code &  & Befehle, die zu Ende der Box gesetzt werden \\
        postCode & Code &  & Befehle, die nach der Box gesetzt werden \\
        usestyle & Box & <Def> & Basisbox \\
        emblem & Code &  & Titelverzierer\\
        createlist & Bool & false & Erstelle Liste \\
        customlist & Bool & false & Trage Box in Liste ein \\
        lock & Lock & TRUE & Setzt die Zählersperre \\
        listname & String & <name> & Name der Liste \\
        listtext & String & <name> & Titel der Liste\\
        listmen & String & NO & Mnemonic der Liste \\
        numbersize & Zahl & 5 & Schriftgröße Nummerierung \\
        labelsize & Zahl & 10 & Schriftgröße Texte \\
        \bottomrule
    \end{tabularx}
\end{center}

%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%
% Current State                                                      %
%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%
%% TODO: Make the TransferBoxXXX commands :D

\section{Die Boxmodi}
\subsection{Default-Design}
Mit \LILLYxBOXxVersion{\small 1.0.0} stellt dieses Design den Urvater dar. Im Folgenden wird auf die genaue Implementation eingegangen:\newline
Auf Basis des Pakets \T{tcolorbox} definiert LILLY das Design \T{LillyxBOXxDesignxDefault} - auf das Großschreiben von Lilly wurde hier bewusst verzichtet - mit folgender Implementation:
{\begin{lstlisting}[language=lLatex]
\tcbset{LillyxBOXxDesignxDefault/.style={enhanced jigsaw, pad before break*=2mm %
    pad after break=2mm, lines before break=4, before skip=0pt, boxrule = 0mm, toprule=0.5mm,%
    bottomtitle=0.5mm,bottomrule=1.2mm, after skip=0pt, enlarge top by=\baselineskip,%
    enlarge bottom by=\baselineskip, sharp corners=south, enforce breakable}%
}
\end{lstlisting}}
Bisher definiert LILLY die Counter über die Einstellung \verb|auto counter| - dies soll aber bald auf das vom eagleStudiPackage Package verwendete \T{counter}-Verfahren umgestellt werden. Bis dato sieht eine exemplarische Definition einer Box wie folgt aus:
{\begin{lstlisting}[language=lLatex]
\DeclareTColorBox[auto counter]%
    {LILLYxBOXxDefinition}%
    { O{} O{Definition \thetcbcounter~} O{drop fuzzy shadow} }%
    {LillyxBOXxDesignxDefault, colback=\LILLYxColorxDefinition!5!white,%
        colframe=\LILLYxColorxDefinition, #3,%
        title={%
            \begin{minipage}[t][\baselineskip][l]{\textwidth}%
                \textbf{\textsc{{#2}}} \hfill {\textbf{#1}}%
            \end{minipage}%
        }%
    }
\end{lstlisting}}
Hiervon weichen nur 2 Definitionen ab. Die der Aufgaben-Box:
\begingroup{\begin{lstlisting}[language=lLatex]
\DeclareTColorBox{LILLYxBOXxAufgabe}{O{} O{} O{}}{enforce breakable,%
    colback=white,colframe=black!50,boxrule=0.2mm,%
    attach boxed title to top left={xshift=1cm,yshift*=1mm-\tcboxedtitleheight},%
    varwidth boxed title*=-3cm,%
    boxed title style={
        frame code={
            \path[fill=white!30!black]%
                ([yshift=-1mm,xshift=-1mm]frame.north west)%
                    arc[start angle=0,!*\T{end}*! angle=180,radius=1mm]%
                ([yshift=-1mm,xshift=1mm]frame.north east)%
                    arc[start angle=180,!*\T{end}*! angle=0,radius=1mm];
            \path[left color=white!40!black,right color=white!40!black,
                    middle color=white!55!black]
                ([xshift=-2mm]frame.north west) -- ([xshift=2mm]frame.north east)%
                [rounded corners=1mm]-- ([xshift=1mm,yshift=-1mm]frame.north east)%
                -- (frame.south east) -- (frame.south west)%
                -- ([xshift=-1mm,yshift=-1mm]frame.north west)%
                [sharp corners]-- cycle;%
        },interior engine=empty,%
    },
    enhanced jigsaw, before skip=2mm,after skip=2mm,%
    fonttitle=\bfseries, #3,%
    title={#2 \ifthenelse{\equal{#1}{}}{}{--~}#1}, %Aufgabe
}
\end{lstlisting}}
Und die der Plain-Box:
{\begin{lstlisting}[language=lLatex]
\DeclareTColorBox{LILLYxBOXxAufgabexPlain}{O{} O{} O{}} {%
        enforce breakable, enhanced jigsaw, before skip=2mm,after skip=2mm,%
        colback=white,colframe=black!50,boxrule=0.2mm,fonttitle=\bfseries,%
        #3,title={#2 \ifthenelse{\equal{#1}{}}{}{--~}#1}%
    }
\end{lstlisting}}
