\documentclass[Typ=PLAIN]{Lilly}


\usepackage{framed}
\usepackage{titletoc}
%\usepackage{titlesec}
\usepackage{minitoc}
\usepackage{microtype}

\setcounter{minitocdepth}{4}
\nomtcrule
\renewcommand{\stcfont}{\small\rm}
\renewcommand{\stcSSfont}{\small\bf}

\tcbset{
  presenterstyle/.style={%
    colback=MudWhite!5,
    boxrule=1pt, 
    enhanced jigsaw, 
    breakable=true,
    opacityback=0.9,
    arc is angular=5mm,
    fuzzy halo=0.1mm with MudWhite,
    top=0.1mm,
    bottom=0.11mm,
    colframe=Charcoal,
  }
}

\def\lfseries{\fontseries{l}\selectfont}

%%% Set Fonts for the document :D
% https://tug.org/FontCatalogue/lato/
\RequirePackage[default]{lato}

%% We will reset the Geometry-Layout to achieve a more beautiful Page-Layout:
\AtBeginDocument{%
	\newgeometry{a4paper, ignoreheadfoot,
				 left=3.4cm, right=2.6cm,
				 top=3cm, bottom=3.5cm,
				 nohead, marginparwidth=0cm,
                 marginparsep=0mm}
    \pagenumbering{arabic}
    \dominitoc
}

\DeclareFixedFont{\tocFont}{U}{eur}{b}{n}{10} %% Euler Font f√ºr die Kapitelnummern - ich finde die toll
\DeclareFixedFont{\chpNumber}{U}{eur}{b}{n}{165}


\addto\captionsngerman{%
        \renewcommand{\contentsname}{\hbox{}\lfseries\Huge{Inhaltsverzeichnis\hbox{}\relax}}%
}

\renewenvironment{leftbar}{
	\def\FrameCommand{
		\hspace*{-.2\textwidth}
		{\color{AuroMetalSaurus}\vrule width 2pt depth 6pt}\hspace{1em}
	}
	\MakeFramed{
		\parshape 1 0cm \dimexpr\textwidth-.5\textwidth\relax\FrameRestore
	}\vskip2pt%
}{\endMakeFramed}

\titlecontents{chapter}
  [0em]{\vspace*{1\baselineskip}}
  {%
    \begin{minipage}{\textwidth}
    \parbox{.1\linewidth}{\hfill\Huge\bfseries{\thecontentspage}}%
   \vspace{-2.85\baselineskip}\hspace{5em}\leftbar{\vspace{0.5em}\tocFont\chaptername~\thecontentslabel}\\
   \Large
  }
  {%
    \begin{minipage}{\textwidth}
    \parbox{0.1\linewidth}{\hfill\Huge\bfseries\thecontentspage}%
   \vspace{-2.85\baselineskip}\leftbar{}\\}
  {\endleftbar\end{minipage}\nopagebreak}[\vskip2pt\nopagebreak]
\titlecontents{section}
  [8.4em]
  {\sffamily\contentslabel{3em}}{}{}
  {\hspace{0.5em}\nobreak\itshape\color{AuroMetalSaurus}\contentspage}
\titlecontents{subsection}
  [8.4em]
  {\sffamily\contentslabel{3em}}{}{}
  {\hspace{0.5em}\nobreak\itshape\color{AuroMetalSaurus}\contentspage}




%
%
%

\setlength{\parskip}{1ex}\setlength{\parindent}{0ex}
\setlength{\skip\footins}{0.75cm}\setlength{\footnotesep}{2mm}

%% Define and set the Title:

% font sizes:
\titleformat{\chapter}[display]
	{\Huge}{\chaptertitlename}
    {29pt}{\fontsize{2cm}{1em}\selectfont\Large}%\startcontents[chapters]}%\chapterfont}
\titleformat*{\section}{\Huge\Large}%\titlefont}
\titleformat*{\subsection}{\huge}%\titlefont}
\titleformat*{\subsubsection}{\LARGE}%\titlefont}

% spacing:
\titlespacing*{\chapter}{0mm}{50pt}{20pt}
\titlespacing*{name=\chapter,numberless}{0pt}{20pt}{20pt} %starred
\titlespacing*{\section}{0mm}{4mm}{3mm}
\titlespacing*{\subsection}{0mm}{3mm}{2mm}
\titlespacing*{\subsubsection}{0mm}{2mm}{1.5mm}

\newcommand{\printMiniToc}{
    \hfill\parbox[t]{.25\textwidth}{
		{\mbox{}\\
			\mbox{}\bfseries{\chpNumber\hfill\thechapter}}
	}
	\parbox[t]{.65\textwidth}{\vspace*{1.5cm}
		\begin{flushright}
			{\Large\textbf{Zusammenfassung}}\quad \raisebox{-0.2mm}{\faList}
		\end{flushright}
        \vspace*{-3mm}
        \begin{tcolorbox}[presenterstyle]
			\hypersetup{linkcolor=black}\lfseries
            \begin{spacing}{1.15}
                \makeatletter
                \minitoc
                %\printcontents[chapters]{p}{1}{\setcounter{tocdepth}{4}}
			\end{spacing}
			\vspace*{-1mm}
        \end{tcolorbox}
	}\hspace*{1cm}
	\bigskip
}

\titlecontents{psection}[2.3em]
{} {\contentslabel{2.3em}} {} {\titlerule*[1pc]{.}\contentspage}
\titlecontents{psubsection}[5.5em]
{} {\contentslabel{3.2em}} {} {\titlerule*[1pc]{.}\contentspage}





\begin{document}
{\hypersetup{linkcolor=black}
\setcounter{tocdepth}{0}

\tableofcontents
}


\chapter{Da wo die Sonne scheint}
\printMiniToc
\section{SectionA}
\section{SectionB}
\section{SectionC}
\subsection{SubsectionA}
\subsection{SubsectionB}

\chapter{Da wo der Regen weint}
\printMiniToc
\section{SectionA}
\section{SectionB}
\section{SectionC}
\subsection{SubsectionA}
\subsection{SubsectionB}

\chapter{Da wo der Wuffel graint}
\printMiniToc
\section{SectionA}
\section{SectionB}
\section{SectionC}
\subsection{SubsectionA}
\subsection{SubsectionB}

\end{document}