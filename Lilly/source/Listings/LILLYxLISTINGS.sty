\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{LILLYxLISTINGS}[2019/07/14 Stellt die Listings-Erweiterungen fuer LILLY zur Verfuegung]

\RequirePackage{LILLYxPACKAGExCTRL} %% DemandPackage und LoadPackage
\RequirePackage{LILLYxCONTROLLERxCONTENT}

%%% Die Verwaltung der Listings verläuft auf verschiedene Highlighting-Module welche auch über die Kommandozeile definiert werden können

\LILLYxPoliteKnock{listingsutf8}{% wir wollen natürlich UTF8, wenns geht
%% https://www.ctan.org/pkg/listingsutf8
\LILLYxDemandPackage{listingsutf8}{Tolle Umlaute in tollen Codes}
                    {Also dieser Fehler sollte nun wirklich nicht vorkommen.}
                    {}{}
}{
%% https://www.ctan.org/pkg/listings
\LILLYxDemandPackage{listings}{Tolle Codes}
                    {Also mit irgendwas muss ich arbeiten.}
                    {}{}
}
%% https://tex.stackexchange.com/questions/34896/coloring-digits-with-the-listings-package/34952#34952
\newcommand\digitstyle{\color{DarkMidnightBlue}}
\makeatletter
\newcommand{\ProcessDigit}[1]
{\begingroup%
  \ifnum\lst@mode=\lst@Pmode\relax%
   {\digitstyle #1}%
  \else
    #1%
  \fi\hbox{\relax{}}\endgroup%
}
\makeatother

%% WS gobble fix for literate replacement - same code but with switching whitespacefalse to false
\makeatletter
\def\lst@Literate#1#2#3{%
    \ifx\relax#2\@empty\else
        \lst@CArgX #1\relax\lst@CDef
            {}
            {\let\lst@next\@empty
             \lst@ifxliterate
                \lst@ifmode \let\lst@next\lst@CArgEmpty \fi
             \fi
             \ifx\lst@next\@empty
                 \ifx\lst@OutputBox\@gobble\else
                   \lst@XPrintToken \let\lst@scanmode\lst@scan@m
                   \lst@token{#2}\lst@length#3\relax
                   \lst@XPrintToken
                   \lst@whitespacefalse %!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
                 \fi
                 \let\lst@next\lst@CArgEmptyGobble
             \fi
             \lst@next}%
            \@empty
        \expandafter\lst@Literate
    \fi}
\makeatother

%% Konfigurere Sonderzeichen
\lstset{literate=
  {á}{{\'a}}1 {é}{{\'e}}1 {í}{{\'i}}1 {ó}{{\'o}}1 {ú}{{\'u}}1
  {Á}{{\'A}}1 {É}{{\'E}}1 {Í}{{\'I}}1 {Ó}{{\'O}}1 {Ú}{{\'U}}1
  {à}{{\`a}}1 {è}{{\`e}}1 {ì}{{\`i}}1 {ò}{{\`o}}1 {ù}{{\`u}}1
  {À}{{\`A}}1 {È}{{\'E}}1 {Ì}{{\`I}}1 {Ò}{{\`O}}1 {Ù}{{\`U}}1
  {ä}{{\"a}}1 {ë}{{\"e}}1 {ï}{{\"i}}1 {ö}{{\"o}}1 {ü}{{\"u}}1
  {Ä}{{\"A}}1 {Ë}{{\"E}}1 {Ï}{{\"I}}1 {Ö}{{\"O}}1 {Ü}{{\"U}}1
  {â}{{\^a}}1 {ê}{{\^e}}1 {î}{{\^i}}1 {ô}{{\^o}}1 {û}{{\^u}}1
  {Â}{{\^A}}1 {Ê}{{\^E}}1 {Î}{{\^I}}1 {Ô}{{\^O}}1 {Û}{{\^U}}1
  {œ}{{\oe}}1 {Œ}{{\OE}}1 {æ}{{\ae}}1 {Æ}{{\AE}}1 {ß}{{\ss}}1
  {ű}{{\H{u}}}1 {Ű}{{\H{U}}}1 {ő}{{\H{o}}}1 {Ő}{{\H{O}}}1
  {ç}{{\c c}}1 {Ç}{{\c C}}1 {ø}{{\o}}1 {å}{{\r a}}1 {Å}{{\r A}}1
  {€}{{\euro}}1 {£}{{\pounds}}1 {«}{{\guillemotleft}}1
  {»}{{\guillemotright}}1 {ñ}{{\~n}}1 {Ñ}{{\~N}}1 {¿}{{?`}}1
  {:bs:}{{\color{Orchid}\textbackslash}}1 {:bmath:}{{\color{bondiBlue}\$}}1
  {:emath:}{{{\color{bondiBlue}\$}}}1 %spaces
  % {0 }{{{\ProcessDigit{0} }}}2
  % {1 }{{{\ProcessDigit{1} }}}2 {2 }{{{\ProcessDigit{2} }}}2 {3 }{{{\ProcessDigit{3 }}}}2
  % {4 }{{{\ProcessDigit{4} }}}2 {5 }{{{\ProcessDigit{5} }}}2 {6 }{{{\ProcessDigit{6 }}}}2
  % {7 }{{{\ProcessDigit{7} }}}2 {8 }{{{\ProcessDigit{8} }}}2 {9 }{{{\ProcessDigit{9 }}}}2
  {0}{{{\ProcessDigit{0}}}}1
  {1}{{{\ProcessDigit{1}}}}1 {2}{{{\ProcessDigit{2}}}}1 {3}{{{\ProcessDigit{3}}}}1
  {4}{{{\ProcessDigit{4}}}}1 {5}{{{\ProcessDigit{5}}}}1 {6}{{{\ProcessDigit{6}}}}1
  {7}{{{\ProcessDigit{7}}}}1 {8}{{{\ProcessDigit{8}}}}1 {9}{{{\ProcessDigit{9}}}}1
} %Damit die Umlaute in lstlistings auch gescheit formatiert werden.
%% Entnommen der Dokumentation: https://en.wikibooks.org/wiki/LaTeX/Source_Code_Listings

%% Es ist möglich über diesen Befehl das zu ladende Sprachpaket zu definieren
\providecommand{\LILLYxListingsxPACK}{MAIN}

%% Grundlegender Befehl zum Schreiben von Code innerhalb einer zeile, löst nicht die Problematiken wie Sonderzeichen, aber mit irgendwas muss man arbeiten können
\DeclareRobustCommand{\LILLYxwriteLst}[2][]{\tikz[baseline=-0.6ex]{\node[rectangle, minimum height=0.95\baselineskip, inner sep=1pt,draw, rounded corners=4pt,MudWhite, fill=MudWhite, centered]{\,\vphantom{I}\lstinline[#1]!#2!\,};}}

%% Lädt ein entsprechendes Sprachpaket
\input{\LILLYxPATHxLISTINGS/Languages/_LILLY_PACK_\LILLYxListingsxPACK}



